<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             699079512741d             |
    |_______________________________________|
*/
 namespace Pmpr\Module\Panel\REST; use Exception; use Pmpr\Common\Foundation\Interfaces\Constants; use WC_Data_Store; use WC_Order; use WC_Order_Item; use WC_Order_Query; use WC_Product; use WP_Error; use WP_HTTP_Response; use WP_REST_Request; use WP_REST_Response; class Store extends Common { public function __construct() { $this->rest_base = 'store'; parent::__construct(); } public function register_routes() { $this->register('/get-orders', [Constants::wwgusigoaksqmwsm => [$this, 'ogequuuycswsseas']]); $this->register('/get-downloads', [Constants::wwgusigoaksqmwsm => [$this, 'woamsogakkycsqcc']]); } public function ogequuuycswsseas(WP_REST_Request $aqmwamyiwgeeymqa) { $ycoeoaakqyskgykq = $this->issssuygyewuaswa($aqmwamyiwgeeymqa, Constants::gouqcwikiiygyasc); if (!empty($ycoeoaakqyskgykq)) { $qaucgcmmqoceqqqm = $this->ugyeicuiaamcceos($aqmwamyiwgeeymqa); $weyoqgcesqgeusiu = $qaucgcmmqoceqqqm[Constants::ausqeuugegoygouq]; $gwmokccqwwksmwye = $qaucgcmmqoceqqqm[Constants::imywcsggckkcywgk]; $gqgemcmoicmgaqie = new WC_Order_Query(['paginate' => true, Constants::imywcsggckkcywgk => $gwmokccqwwksmwye, Constants::cgiswgcumueqgcmw => $weyoqgcesqgeusiu, Constants::awkcoioakcaougmq => Constants::omaksceqmigeaoko, Constants::gqiasegggowomgie => Constants::kumuoysauoagaiiy, Constants::qkimqmacosgcwmug => $ycoeoaakqyskgykq]); $sogksuscggsicmac = []; $uuwmqqqiwksuaise = $ocqawgquwsqioses = 0; try { $kkmcqsmyioykasqc = $gqgemcmoicmgaqie->get_orders(); foreach ($kkmcqsmyioykasqc->orders as $umwqusowiqmyseom) { if ($umwqusowiqmyseom instanceof WC_Order) { $sogksuscggsicmac[] = $this->imuasgguuaoacukq($umwqusowiqmyseom); } } $uuwmqqqiwksuaise = $kkmcqsmyioykasqc->total; $ocqawgquwsqioses = $kkmcqsmyioykasqc->max_num_pages; } catch (Exception $wgaoewqkwgomoaai) { } $keccaugmemegoimu = [Constants::qwumqqyuasyskkkc => $sogksuscggsicmac, Constants::ycuusiweasqygwiw => [Constants::uiiqiokqwmccomiu => $uuwmqqqiwksuaise, Constants::yusuiaeueqwieqqq => $ocqawgquwsqioses, Constants::asmooogmgyecqqka => $gwmokccqwwksmwye, Constants::ausqeuugegoygouq => $weyoqgcesqgeusiu]]; } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Permission denied', PR__MDL__PANEL)); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function woamsogakkycsqcc(WP_REST_Request $aqmwamyiwgeeymqa) { $ycoeoaakqyskgykq = $this->issssuygyewuaswa($aqmwamyiwgeeymqa, Constants::gouqcwikiiygyasc); if (!empty($ycoeoaakqyskgykq)) { $qaucgcmmqoceqqqm = $this->ugyeicuiaamcceos($aqmwamyiwgeeymqa); $weyoqgcesqgeusiu = $qaucgcmmqoceqqqm[Constants::ausqeuugegoygouq]; $gwmokccqwwksmwye = $qaucgcmmqoceqqqm[Constants::imywcsggckkcywgk]; $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ekymkycgewkiouqe = $this->caokeucsksukesyo()->wikusamwomuogoau(); $sogksuscggsicmac = []; $ekmmkwksseyoeask = $eqwoegegiamegqsm->ueykigukusgcmcsg('woocommerce_downloadable_product_permissions'); $uuwmqqqiwksuaise = $eqwoegegiamegqsm->qaumqeeagueuqkcg($eqwoegegiamegqsm->prepare("SELECT COUNT(*) FROM {$ekmmkwksseyoeask} WHERE user_id = %d", $ycoeoaakqyskgykq)); if ($uuwmqqqiwksuaise > 0) { $qcsqmgqiomwkouwi = $ekymkycgewkiouqe->geaqkgagmmimkegs('customer-download'); $casweeiuuwgqsykq = $qcsqmgqiomwkouwi->get_downloads([Constants::yauicucwkgqyygas => $ycoeoaakqyskgykq, Constants::cgiswgcumueqgcmw => $weyoqgcesqgeusiu, Constants::imywcsggckkcywgk => $gwmokccqwwksmwye]); if (!empty($casweeiuuwgqsykq)) { $icwkuwimswoisqss = $this->caokeucsksukesyo()->gagsyqagguwwauac(); $mumyimcwkaemyyue = $this->uwkmaywceaaaigwo()->owicscwgeuqcqaig(); $usmsssmiougymckk = $this->caokeucsksukesyo()->aqasygcsqysmmyke(); $smeeaysicaigqymu = $this->uwkmaywceaaaigwo()->iqsmaqoiukeasukw(); $gmigwwwmwemyaayy = $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy()->gmigwwwmwemyaayy('/'); foreach ($casweeiuuwgqsykq as $acsweksygkmmgggk) { $umkkkaqkwugkemce = $acsweksygkmmgggk->get_product_id(); $product = $usmsssmiougymckk->get($umkkkaqkwugkemce); if (empty($product)) { continue; } $ayseywwqeyucsime = $acsweksygkmmgggk->get_download_id(); $qiqqgwmcqeqyoqsw = $product->get_file($ayseywwqeyucsime); $acgucmgokweekgag = $acsweksygkmmgggk->get_downloads_remaining(); if (!$acgucmgokweekgag) { $acgucmgokweekgag = __('Unlimited', PR__MDL__PANEL); } $kcgscimsiaeewmge = $acsweksygkmmgggk->get_access_expires(); if ($kcgscimsiaeewmge) { $kcgscimsiaeewmge = $icwkuwimswoisqss->ekasyoagocygouom($kcgscimsiaeewmge); } else { $kcgscimsiaeewmge = __('No Expire', PR__MDL__PANEL); } $sogksuscggsicmac[] = ['download_id' => $ayseywwqeyucsime, 'download_url' => $mumyimcwkaemyyue->yqymaqmqiqmmmsoo(['download_file' => $umkkkaqkwugkemce, Constants::awkcoioakcaougmq => $acsweksygkmmgggk->get_order_key(), Constants::muqaqimusmckkieq => rawurlencode($acsweksygkmmgggk->get_user_email()), Constants::ascagqcquwgmygkm => $ayseywwqeyucsime], $gmigwwwmwemyaayy), 'remaining' => $acgucmgokweekgag, 'expires' => $kcgscimsiaeewmge, Constants::woicooamkeqiaemo => $acsweksygkmmgggk->get_product_id(), Constants::qescuiwgsyuikume => $qiqqgwmcqeqyoqsw->get_name(), 'product_title' => $product->get_title(), Constants::sauwwsocmukoaayu => $product->get_permalink(), Constants::egwoacukmsioosum => $smeeaysicaigqymu->iaykyouimqoikagg($product->get_image_id())]; } } } $keccaugmemegoimu = [Constants::qwumqqyuasyskkkc => $sogksuscggsicmac, Constants::ycuusiweasqygwiw => [Constants::uiiqiokqwmccomiu => $uuwmqqqiwksuaise, Constants::yusuiaeueqwieqqq => ceil($uuwmqqqiwksuaise / $weyoqgcesqgeusiu), Constants::asmooogmgyecqqka => $gwmokccqwwksmwye, Constants::ausqeuugegoygouq => $weyoqgcesqgeusiu]]; } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Permission denied', PR__MDL__PANEL)); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } private function imuasgguuaoacukq(WC_Order $umwqusowiqmyseom) { $cgceoyqmmwumqyqa = $this->uwkmaywceaaaigwo()->wikusamwomuogoau(); $qqacemimwuamsqqc = $this->uwkmaywceaaaigwo()->mmmcswscsiecscwg(); $iueymcwwscwqkiyq = $umwqusowiqmyseom->get_status(); return [Constants::gouqcwikiiygyasc => $umwqusowiqmyseom->get_id(), Constants::eymwucuaaiiciymc => $umwqusowiqmyseom->get_order_number(), 'status_label' => $qqacemimwuamsqqc->isamiwuouuqooysq($iueymcwwscwqkiyq), Constants::ciywsqoeiymemsys => $iueymcwwscwqkiyq, Constants::CURRENCY => $umwqusowiqmyseom->get_currency(), Constants::CREATED_AT => $cgceoyqmmwumqyqa->eokiemeewccmcaqo($umwqusowiqmyseom->get_date_created()), 'total' => $umwqusowiqmyseom->get_total(), 'total_html' => $umwqusowiqmyseom->get_formatted_order_total(), 'subtotal' => $umwqusowiqmyseom->get_subtotal(), 'subtotal_html' => $cgceoyqmmwumqyqa->aumscagymwyyicag($umwqusowiqmyseom->get_subtotal()), 'shipping' => $umwqusowiqmyseom->get_shipping_total(), 'shipping_html' => $cgceoyqmmwumqyqa->aumscagymwyyicag($umwqusowiqmyseom->get_shipping_total()), 'discount' => $umwqusowiqmyseom->get_discount_total(), 'discount_html' => $cgceoyqmmwumqyqa->aumscagymwyyicag($umwqusowiqmyseom->get_discount_total()), 'payment_method' => $umwqusowiqmyseom->get_payment_method(), 'payment_method_title' => $umwqusowiqmyseom->get_payment_method_title(), 'is_paid' => $umwqusowiqmyseom->is_paid(), 'payment_link' => $umwqusowiqmyseom->get_checkout_payment_url(), 'needs_payment' => $umwqusowiqmyseom->needs_payment(), 'line_items' => $this->qmkcgaagkwuigiio($umwqusowiqmyseom)]; } private function qmkcgaagkwuigiio(WC_Order $umwqusowiqmyseom) { $mckqcgygckkuiiuc = []; $cgceoyqmmwumqyqa = $this->uwkmaywceaaaigwo()->wikusamwomuogoau(); $smeeaysicaigqymu = $this->uwkmaywceaaaigwo()->iqsmaqoiukeasukw(); foreach ($umwqusowiqmyseom->get_items() as $igqsaukqcqscimok) { $product = $igqsaukqcqscimok->get_product(); if (!$product instanceof WC_Product) { continue; } $mckqcgygckkuiiuc[] = [Constants::gouqcwikiiygyasc => $igqsaukqcqscimok->get_id(), Constants::acymsykymkiewqsy => $umwqusowiqmyseom->get_item_total($igqsaukqcqscimok), Constants::ueasagmikqewqcay => $cgceoyqmmwumqyqa->aumscagymwyyicag($umwqusowiqmyseom->get_item_total($igqsaukqcqscimok)), 'total' => $igqsaukqcqscimok->get_total(), 'total_html' => $cgceoyqmmwumqyqa->aumscagymwyyicag($igqsaukqcqscimok->get_total()), Constants::eqkiuiogcaeskmgu => $igqsaukqcqscimok->get_quantity(), Constants::woicooamkeqiaemo => $product->get_id(), Constants::qescuiwgsyuikume => $product->get_title(), Constants::sauwwsocmukoaayu => $product->get_permalink(), Constants::egwoacukmsioosum => $smeeaysicaigqymu->iaykyouimqoikagg($product->get_image_id())]; } return $mckqcgygckkuiiuc; } public function ackuaigiocsgyqwe(WP_REST_Request $aqmwamyiwgeeymqa) : bool { return !empty($this->issssuygyewuaswa($aqmwamyiwgeeymqa)); } }
